<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É—Ö–Ω—è mrlOnsf üöÄ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a1a; 
            color: white; 
            padding: 20px; 
            margin: 0; 
            text-align: center; 
        }
        h1 { color: #ff9500; }
        button { 
            background: #0088cc; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            margin: 5px; 
            cursor: pointer; 
            font-size: 16px; 
            transition: background 0.3s; 
            display: inline-block; 
        }
        button:hover { background: #007acc; }
        input { 
            padding: 12px; 
            width: 80%; 
            max-width: 300px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border: 1px solid #333; 
            background: #333; 
            color: white; 
        }
        #result { 
            margin-top: 20px; 
            padding: 20px; 
            background: #333; 
            border-radius: 8px; 
            text-align: left; 
            min-height: 100px; 
            display: none; 
            animation: fadeIn 0.5s ease-in; 
        }
        #generatedImage { 
            max-width: 100%; 
            border-radius: 8px; 
            margin-top: 10px; 
        }
        .loading { animation: pulse 1.5s infinite; color: #ff9500; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }
        a { color: #ff9500; text-decoration: none; }
    </style>
</head>
<body>
    <h1>–ö—É—Ö–Ω—è mrlOnsf üöÄ</h1>
    <p>–í–±–µ–π –∑–∞–ø—Ä–æ—Å –∏ –∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–Ω–∏–∑—É!</p>
    
    <input type="text" id="query" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–æ—Ç –≤ –∫–æ—Å–º–æ—Å–µ –∏–ª–∏ 2+2*5">
    <br>
    
    <button id="btnRecipe">üç≥ –†–µ—Ü–µ–ø—Ç —Å –∫–∞–ª–æ—Ä–∏—è–º–∏</button>
    <button id="btnImage">üñºÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏</button>
    <button id="btnSearch">üîç –ü–æ–∏—Å–∫ –≤ Google</button>
    <button id="btnMath">üßÆ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</button>
    <button id="btnPresentation">üìä –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</button>
    
    <div id="result">
        <p class="loading" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        <img id="generatedImage" src="" alt="–ö–∞—Ä—Ç–∏–Ω–∫–∞" style="display: none;">
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Mini App (–ø—Ä–æ–≤–µ—Ä–∫–∞ SDK)
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        } else {
            console.error('Telegram SDK not loaded'); // –õ–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        }

        // –ö–ª—é—á–∏
        const TAVILY_KEY = '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';
        const HF_TOKEN = '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';

        function showResult(html) {
            const result = document.getElementById('result');
            result.innerHTML = html;
            result.style.display = 'block';
            document.getElementById('loadingText').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π onclick –Ω–∞ addEventListener)
        function attachButtonListeners() {
            document.getElementById('btnRecipe').addEventListener('click', generateRecipe);
            document.getElementById('btnImage').addEventListener('click', generateImage);
            document.getElementById('btnSearch').addEventListener('click', googleSearch);
            document.getElementById('btnMath').addEventListener('click', solveMath);
            document.getElementById('btnPresentation').addEventListener('click', makePresentation);
        }

        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', attachButtonListeners);

        // 1. –†–µ—Ü–µ–ø—Ç
        async function generateRecipe() {
            const query = document.getElementById('query').value || '—É–∂–∏–Ω';
            showResult('<p class="loading">–ì–µ–Ω–µ—Ä–∏—Ä—É—é —Ä–µ—Ü–µ–ø—Ç...</p>');
            try {
                const res = await fetch('https://api-inference.huggingface.co/models/Qwen/Qwen2.5-32B-Instruct', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${HF_TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        inputs: `–†–µ—Ü–µ–ø—Ç ${query}: –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, —à–∞–≥–∏, –∫–∞–ª–æ—Ä–∏–∏. –ñ–∏–≤–æ–π —è–∑—ã–∫.`, 
                        parameters: { max_new_tokens: 300 } 
                    })
                });
                const data = await res.json();
                showResult(`<h3>–†–µ—Ü–µ–ø—Ç: ${query}</h3><p>${data[0]?.generated_text || '–ì–æ—Ç–æ–≤–æ! üòã'}</p>`);
            } catch (err) {
                console.error('Recipe error:', err); // –õ–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                showResult('<p>–û—à–∏–±–∫–∞ —Ä–µ—Ü–µ–ø—Ç–∞. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ! üòÖ</p>');
            }
        }

        // 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏
        async function generateImage() {
            const prompt = document.getElementById('query').value || '–∫–∞—Ä—Ç–∏–Ω–∫–∞';
            showResult('<p class="loading">–ì–µ–Ω–µ—Ä–∏—Ä—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É...</p>');
            try {
                const res = await fetch('https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-schnell', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${HF_TOKEN}` },
                    body: JSON.stringify({ inputs: prompt, parameters: { num_inference_steps: 4 } })
                });
                if (!res.ok) throw new Error('API error');
                const blob = await res.blob();
                const url = URL.createObjectURL(blob);
                document.getElementById('generatedImage').src = url;
                document.getElementById('generatedImage').style.display = 'block';
                showResult(`<h3>–ö–∞—Ä—Ç–∏–Ω–∫–∞: ${prompt}</h3><p>–ì–æ—Ç–æ–≤–æ! üé®</p>`);
            } catch (err) {
                console.error('Image error:', err);
                showResult('<p>–ù–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª. –û–ø–∏—à–∏ –ø—Ä–æ—â–µ! üòî</p>');
            }
        }

        // 3. –ü–æ–∏—Å–∫ –≤ Google
        async function googleSearch() {
            const query = document.getElementById('query').value || '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è';
            showResult('<p class="loading">–ò—â—É –≤ Google...</p>');
            try {
                const res = await fetch('https://api.tavily.com/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ api_key: TAVILY_KEY, query, search_depth: 'basic', include_answer: true, max_results: 3 })
                });
                const data = await res.json();
                let answer = data.answer || data.results?.map(r => `<p><strong>${r.title}</strong><br>${r.content.substring(0, 200)}...<br><a href="${r.url}" target="_blank">–ò—Å—Ç–æ—á–Ω–∏–∫</a></p>`).join('') || '–ù–µ –Ω–∞—à—ë–ª. –ü–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä—É–π! üîç';
                showResult(`<h3>–ü–æ–∏—Å–∫: ${query}</h3>${answer}`);
            } catch (err) {
                console.error('Search error:', err);
                showResult('<p>–ü–æ–∏—Å–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç! üåê</p>');
            }
        }

        // 4. –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞
        async function solveMath() {
            const query = document.getElementById('query').value || '2+2';
            showResult('<p class="loading">–†–µ—à–∞—è...</p>');
            try {
                // Lazy-load math.js
                if (!window.math) {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.1/math.min.js';
                    document.head.appendChild(script);
                    script.onload = () => {
                        const result = window.math.evaluate(query);
                        showResult(`<h3>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: ${query}</h3><p>–û—Ç–≤–µ—Ç: ${result} üßÆ</p>`);
                    };
                } else {
                    const result = window.math.evaluate(query);
                    showResult(`<h3>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: ${query}</h3><p>–û—Ç–≤–µ—Ç: ${result} üßÆ</p>`);
                }
            } catch (err) {
                console.error('Math error:', err);
                showResult('<p>–ù–µ —Ä–µ—à–∏–ª. –í–≤–µ–¥–∏ –ø—Ä–æ—Å—Ç–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ! üòÖ</p>');
            }
        }

        // 5. –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è (—Å–∏–º—É–ª—è—Ü–∏—è)
        async function makePresentation() {
            const query = document.getElementById('query').value || '—Ç–µ–º–∞';
            showResult('<p class="loading">–î–µ–ª–∞—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é...</p>');
            setTimeout(() => {
                showResult(`<h3>–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è: ${query}</h3><p>–ì–æ—Ç–æ–≤–∞! <a href="#" onclick="alert('–°–∫–∞—á–∏–≤–∞—é PPTX...')">–°–∫–∞—á–∞—Ç—å</a> üìä</p>`);
            }, 2000);
        }
    </script>
</body>
</html>
