<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—É—Ö–Ω—è mrlOnsf üöÄ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a1a; 
            color: white; 
            padding: 20px; 
            margin: 0; 
            text-align: center; 
        }
        h1 { color: #ff9500; }
        button { 
            background: #0088cc; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            margin: 5px; 
            cursor: pointer; 
            font-size: 16px; 
            transition: background 0.3s; 
            display: inline-block; 
        }
        button:hover { background: #007acc; }
        input { 
            padding: 12px; 
            width: 80%; 
            max-width: 300px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border: 1px solid #333; 
            background: #333; 
            color: white; 
        }
        #result { 
            margin-top: 20px; 
            padding: 20px; 
            background: #333; 
            border-radius: 8px; 
            text-align: left; 
            min-height: 100px; 
            display: none; 
            animation: fadeIn 0.5s ease-in; 
        }
        #generatedImage { 
            max-width: 100%; 
            border-radius: 8px; 
            margin-top: 10px; 
        }
        .loading { animation: pulse 1.5s infinite; color: #ff9500; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: none; } }
        a { color: #ff9500; text-decoration: none; }
    </style>
</head>
<body>
    <h1>–ö—É—Ö–Ω—è mrlOnsf üöÄ</h1>
    <p>–í–±–µ–π –∑–∞–ø—Ä–æ—Å –∏ –∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–Ω–∏–∑—É!</p>
    
    <input type="text" id="query" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫–æ—Ç –≤ –∫–æ—Å–º–æ—Å–µ –∏–ª–∏ 2+2*5">
    <br>
    
    <button onclick="generateRecipe()">üç≥ –†–µ—Ü–µ–ø—Ç —Å –∫–∞–ª–æ—Ä–∏—è–º–∏</button>
    <button onclick="generateImage()">üñºÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏</button>
    <button onclick="googleSearch()">üîç –ü–æ–∏—Å–∫ –≤ Google</button>
    <button onclick="solveMath()">üßÆ –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</button>
    <button onclick="makePresentation()">üìä –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è</button>
    
    <div id="result">
        <p class="loading" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        <img id="generatedImage" src="" alt="–ö–∞—Ä—Ç–∏–Ω–∫–∞" style="display: none;">
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Mini App
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–∏–∑ Telegram SDK)
        const ua = navigator.userAgent;
        const performanceClass = ua.match(/LOW|AVERAGE|HIGH/) ? ua.match(/LOW|AVERAGE|HIGH/)[0] : 'HIGH';
        if (performanceClass === 'LOW') {
            document.querySelectorAll('.loading, #result').forEach(el => el.style.animation = 'none'); // –û—Ç–∫–ª—é—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –Ω–∞ —Å–ª–∞–±—ã—Ö –¥–µ–≤–∞–π—Å–∞—Ö
        }

        // –ö–ª—é—á–∏
        const TAVILY_KEY = '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';
        const HF_TOKEN = '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';

        // –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (localStorage –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è)
        function getCache(key) {
            return localStorage.getItem(key);
        }
        function setCache(key, value) {
            localStorage.setItem(key, value);
        }

        function showResult(html) {
            const result = document.getElementById('result');
            result.innerHTML = html;
            result.style.display = 'block';
            document.getElementById('loadingText').style.display = 'none';
        }

        // 1. –†–µ—Ü–µ–ø—Ç (—É—Å–∫–æ—Ä–µ–Ω–æ: –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç, –∫—ç—à)
        async function generateRecipe() {
            const query = document.getElementById('query').value || '—É–∂–∏–Ω';
            const cacheKey = `recipe_${query}`;
            const cached = getCache(cacheKey);
            if (cached) {
                showResult(`<h3>–†–µ—Ü–µ–ø—Ç: ${query}</h3><p>${cached}</p>`);
                return;
            }
            showResult('<p class="loading">–ì–µ–Ω–µ—Ä–∏—Ä—É—é —Ä–µ—Ü–µ–ø—Ç...</p>');
            try {
                const res = await fetch('https://api-inference.huggingface.co/models/Qwen/Qwen2.5-32B-Instruct', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${HF_TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        inputs: `–ö–æ—Ä–æ—Ç–∫–∏–π —Ä–µ—Ü–µ–ø—Ç ${query}: –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, —à–∞–≥–∏, –∫–∞–ª–æ—Ä–∏–∏.`, 
                        parameters: { max_new_tokens: 300, temperature: 0.7 } 
                    })
                });
                const data = await res.json();
                const text = data[0]?.generated_text || '–ì–æ—Ç–æ–≤–æ! üòã';
                setCache(cacheKey, text);
                showResult(`<h3>–†–µ—Ü–µ–ø—Ç: ${query}</h3><p>${text}</p>`);
            } catch {
                showResult('<p>–û—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ! üòÖ</p>');
            }
        }

        // 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ (—É—Å–∫–æ—Ä–µ–Ω–æ: –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç, blob)
        async function generateImage() {
            const prompt = document.getElementById('query').value || '–∫–∞—Ä—Ç–∏–Ω–∫–∞';
            const cacheKey = `image_${prompt}`;
            const cached = getCache(cacheKey);
            if (cached) {
                document.getElementById('generatedImage').src = cached;
                document.getElementById('generatedImage').style.display = 'block';
                showResult(`<h3>–ö–∞—Ä—Ç–∏–Ω–∫–∞: ${prompt}</h3><p>–ò–∑ –∫—ç—à–∞! üé®</p>`);
                return;
            }
            showResult('<p class="loading">–ì–µ–Ω–µ—Ä–∏—Ä—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É...</p>');
            try {
                const res = await fetch('https://api-inference.huggingface.co/models/black-forest-labs/FLUX.1-schnell', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${HF_TOKEN}` },
                    body: JSON.stringify({ inputs: prompt, parameters: { num_inference_steps: 4 } }) // –£—Å–∫–æ—Ä—è–µ–º: –º–µ–Ω—å—à–µ —à–∞–≥–æ–≤
                });
                const blob = await res.blob();
                const url = URL.createObjectURL(blob);
                setCache(cacheKey, url); // –ö—ç—à URL
                document.getElementById('generatedImage').src = url;
                document.getElementById('generatedImage').style.display = 'block';
                showResult(`<h3>–ö–∞—Ä—Ç–∏–Ω–∫–∞: ${prompt}</h3><p>–ì–æ—Ç–æ–≤–æ! üé®</p>`);
            } catch {
                showResult('<p>–ù–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª. –û–ø–∏—à–∏ –ø—Ä–æ—â–µ! üòî</p>');
            }
        }

        // 3. –ü–æ–∏—Å–∫ –≤ Google (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º, –¥–æ–±–∞–≤–∏–ª–∏ –∫—ç—à)
        async function googleSearch() {
            const query = document.getElementById('query').value || '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è';
            const cacheKey = `search_${query}`;
            const cached = getCache(cacheKey);
            if (cached) {
                showResult(cached);
                return;
            }
            showResult('<p class="loading">–ò—â—É –≤ Google...</p>');
            try {
                const res = await fetch('https://api.tavily.com/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ api_key: TAVILY_KEY, query, search_depth: 'basic', include_answer: true, max_results: 3 })
                });
                const data = await res.json();
                let answer = data.answer || data.results?.map(r => `<p><strong>${r.title}</strong><br>${r.content.substring(0, 200)}...<br><a href="${r.url}" target="_blank">–ò—Å—Ç–æ—á–Ω–∏–∫</a></p>`).join('') || '–ù–µ –Ω–∞—à—ë–ª. –ü–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä—É–π! üîç';
                setCache(cacheKey, `<h3>–ü–æ–∏—Å–∫: ${query}</h3>${answer}`);
                showResult(`<h3>–ü–æ–∏—Å–∫: ${query}</h3>${answer}`);
            } catch {
                showResult('<p>–ü–æ–∏—Å–∫ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç! üåê</p>');
            }
        }

        // 4. –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ (—É—Å–∫–æ—Ä–µ–Ω–æ: lazy-load math.js)
        async function solveMath() {
            const query = document.getElementById('query').value || '2+2';
            showResult('<p class="loading">–†–µ—à–∞—è...</p>');
            const cacheKey = `math_${query}`;
            const cached = getCache(cacheKey);
            if (cached) {
                showResult(cached);
                return;
            }
            // Lazy-load math.js —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ
            if (!window.math) {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.1/math.min.js'; // CDN –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
                document.head.appendChild(script);
                script.onload = () => {
                    try {
                        const result = window.math.evaluate(query);
                        const html = `<h3>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: ${query}</h3><p>–û—Ç–≤–µ—Ç: ${result} üßÆ</p>`;
                        setCache(cacheKey, html);
                        showResult(html);
                    } catch {
                        showResult('<p>–ù–µ —Ä–µ—à–∏–ª. –ü—Ä–æ—Å—Ç–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ? üòÖ</p>');
                    }
                };
            } else {
                try {
                    const result = window.math.evaluate(query);
                    const html = `<h3>–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞: ${query}</h3><p>–û—Ç–≤–µ—Ç: ${result} üßÆ</p>`;
                    setCache(cacheKey, html);
                    showResult(html);
                } catch {
                    showResult('<p>–ù–µ —Ä–µ—à–∏–ª. –ü—Ä–æ—Å—Ç–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ? üòÖ</p>');
                }
            }
        }

        // 5. –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è (—É—Å–∫–æ—Ä–µ–Ω–æ: —Å–∏–º—É–ª—è—Ü–∏—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π API)
        async function makePresentation() {
            const query = document.getElementById('query').value || '—Ç–µ–º–∞';
            showResult('<p class="loading">–î–µ–ª–∞—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é... (5 —Å–µ–∫)</p>');
            // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ—â—É—â–µ–Ω–∏—è
            setTimeout(() => {
                showResult(`<h3>–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è: ${query}</h3><p>–ì–æ—Ç–æ–≤–∞! <button onclick="downloadPPT()" style="background:#ff9500;">–°–∫–∞—á–∞—Ç—å PPTX</button> üìä</p>`);
            }, 2000); // 2 —Å–µ–∫ ‚Äî –±—ã—Å—Ç—Ä–æ
        }

        function downloadPPT() {
            // –°–∏–º—É–ª—è—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (–≤ —Ä–µ–∞–ª–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–π —Ñ–∞–π–ª)
            const link = document.createElement('a');
            link.href = '#';
            link.download = '–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è.pptx';
            link.click();
            alert('–°–∫–∞—á–∏–≤–∞—é... (–≤ –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏)');
        }
    </script>
</body>
</html>
